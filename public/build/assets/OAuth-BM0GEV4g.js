import{C as Y,D as q,a8 as J,u as Q,a9 as X,N as Z,O as ee,r as _,v as te,o as se,b as oe,Y as A,a3 as ne,c as r,e as i,d as n,i as d,f as t,a1 as N,aa as ae,j as p,k as m,m as l,t as a,w as ie,g as k,F as le,G as re,h as ue,I as P,n as x,x as ce}from"./app-CsCdPRLz.js";import{t as de}from"./tabs-DgL9eyj5.js";import{F as pe}from"./Form-BqPELsYX.js";import{U as me}from"./index-BpXPhS-I.js";import{C as _e}from"./circle-plus-BQbJ_-Ea.js";import{C as ve}from"./check-mSr7a7Jc.js";import"./createLucideIcon-B_q_KK3i.js";/*! 2FAuth version 6.0.0 - Copyright (c) 2025 Bubka - https://github.com/Bubka/2FAuth */const he={class:"options-tabs"},fe={key:0,class:"notification is-warning has-text-centered"},ge={key:1,class:"notification is-warning has-text-centered"},ke={class:"title is-4 has-text-grey-light"},be={class:"is-size-7-mobile"},ye={class:"mt-3"},Te={key:2},Ce={class:"tags is-pulled-right"},$e=["onClick"],we=["onClick","title"],Se={key:1,class:"is-size-7-mobile is-size-6 my-3"},Ve={key:2,class:"pat is-family-monospace is-size-6 is-size-7-mobile has-text-success"},Fe={class:"mt-2 is-size-7 is-pulled-right"},Be={key:0,class:"is-overlay modal-otp modal-background"},ze={class:"main-section"},Ae={class:"field is-grouped"},Ne={class:"control"},Pe={class:"control"},De={__name:"OAuth",setup(xe){const M=Y(),{t:v}=q(),b=J(),O=Z("2fauth"),h=ce(),y=Q(),E=X(O.prefix+"returnTo","accounts"),{copy:K}=ee({legacy:!0}),u=_([]),T=_(!1),f=_(!1),g=_(null),C=_(null),$=te(()=>b.enableSso&&b.useSsoOnly&&!b.allowPatWhileSsoOnly||y.authenticated_by_proxy);se(()=>{S()});const c=oe(new pe({name:""}));function S(){T.value=!0,A.getPersonalAccessTokens({returnError:!0}).then(e=>{u.value=[],e.data.forEach(o=>{o.id===C.value?(o.value=g.value,u.value.unshift(o)):u.value.push(o)})}).catch(e=>{e.response.status===403||M.show(e)}).finally(()=>{T.value=!1,C.value=null,g.value=null})}function V(){W(),$.value?h.warn({text:v("error.unsupported_with_reverseproxy")}):f.value=!0}function L(){c.post("/oauth/personal-access-tokens").then(e=>{g.value=e.data.accessToken,C.value=e.data.token.id,S(),f.value=!1,c.reset()})}function U(e){confirm(v("confirmation.revoke_token"))&&A.deletePersonalAccessToken(e).then(o=>{u.value=u.value.filter(w=>w.id!==e),h.success({text:v("notification.token_revoked")})})}function W(){u.value.forEach(e=>{e.value=null}),g.value=null}function D(e){K(e),h.success({text:v("notification.copied_to_clipboard")})}function I(){f.value=!1,c.reset()}return ne(e=>{e.name.startsWith("settings.")||h.clear()}),(e,o)=>{const w=m("Spinner"),j=m("NavigationButton"),G=m("VueFooter"),F=m("FormWrapper"),H=m("FormField"),B=m("VueButton");return l(),r("div",null,[i(t(ae),{tabs:t(de),"active-tab":"settings.oauth.tokens",onTabSelected:o[0]||(o[0]=s=>("router"in e?e.router:t(N)).push({name:s}))},null,8,["tabs"]),n("div",he,[i(F,null,{default:p(()=>[t($)&&t(y).oauth_provider?(l(),r("div",fe,a(e.$t("message.sso_only_x_settings_are_disabled",{auth_method:"OAuth"})),1)):d("",!0),t($)&&t(y).authenticated_by_proxy?(l(),r("div",ge,a(e.$t("message.auth_handled_by_proxy")+" "+e.$t("message.manage_auth_at_proxy_level")),1)):d("",!0),n("h4",ke,a(e.$t("heading.personal_access_tokens")),1),n("div",be,a(e.$t("message.token_legend")),1),n("div",ye,[n("a",{tabindex:"0",class:"is-link",onClick:V,onKeyup:ie(V,["enter"])},[i(t(_e)),k(" "+a(e.$t("link.generate_new_token")),1)],32)]),t(u).length>0?(l(),r("div",Te,[(l(!0),r(le,null,re(t(u),s=>(l(),r("div",{key:s.id,class:"group-item is-size-5 is-size-6-mobile"},[s.value?(l(),ue(t(ve),{key:0,class:"mr-1 has-text-success inline"})):d("",!0),k(a(s.name)+" ",1),n("div",Ce,[i(t(me),null,{default:p(({mode:z})=>[s.value?(l(),r("button",{key:0,type:"button",class:x(["button tag",{"is-link":z!="dark"}]),onClick:P(R=>D(s.value),["stop"])},a(e.$t("label.copy")),11,$e)):d("",!0),n("button",{type:"button",class:x(["button tag",z==="dark"?"is-dark":"is-white"]),onClick:R=>U(s.id),title:e.$t("tooltip.revoke")},a(e.$t("label.revoke")),11,we)]),_:2},1024)]),s.value?(l(),r("span",Se,a(e.$t("message.make_sure_copy_token")),1)):d("",!0),s.value?(l(),r("span",Ve,a(s.value),1)):d("",!0)]))),128)),n("div",Fe,a(e.$t("message.revoking_a_token_is_permanent")),1)])):d("",!0),i(w,{isVisible:t(T)&&t(u).length===0,type:"list-loading"},null,8,["isVisible"]),i(G,null,{default:p(()=>[i(j,{action:"close",onClosed:o[1]||(o[1]=s=>("router"in e?e.router:t(N)).push({name:t(E)})),"current-page-title":e.$t("title.settings.oauth.tokens")},null,8,["current-page-title"])]),_:1})]),_:1})]),t(f)?(l(),r("div",Be,[n("main",ze,[i(F,{title:"heading.new_token"},{default:p(()=>[n("form",{onSubmit:P(L,["prevent"]),onKeydown:o[3]||(o[3]=s=>t(c).onKeydown(s))},[i(H,{modelValue:t(c).name,"onUpdate:modelValue":o[2]||(o[2]=s=>t(c).name=s),fieldName:"name",errorMessage:t(c).errors.get("name"),inputType:"text",label:"field.name",autofocus:""},null,8,["modelValue","errorMessage"]),n("div",Ae,[n("div",Ne,[i(B,{nativeType:"submit",id:"btnGenerateToken",isLoading:t(c).isBusy},{default:p(()=>[k(a(e.$t("label.generate")),1)]),_:1},8,["isLoading"])]),n("div",Pe,[i(B,{onClick:I,nativeType:"button",id:"btnCancel",color:"is-text"},{default:p(()=>[k(a(e.$t("label.cancel")),1)]),_:1})])])],32)]),_:1})])])):d("",!0)])}}};export{De as default};
