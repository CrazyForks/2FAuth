import{ab as X,a8 as B,r as h,c as p,m as r,d as e,n as F,f as s,t as a,e as i,j as E,i as f,g as C,h as D,C as q,D as J,u as K,a9 as O,N as Q,a3 as Y,o as Z,a1 as z,aa as ee,k as _,F as te,G as se,x as ae}from"./app-CLj7mONa.js";import{t as ne}from"./tabs-CopbGQHR.js";import{u as oe}from"./appSettingsUpdater-CFINks3q.js";import{U as le}from"./index-DHvNF7PZ.js";import{C as ie}from"./check-BaUiYB3M.js";import{X as re}from"./x-BF3-YSPD.js";import{_ as ce}from"./CopyButton-DvYqEWxi.js";import{c as de}from"./createLucideIcon-DUteC7o6.js";/*! 2FAuth version 6.0.0 - Copyright (c) 2025 Bubka - https://github.com/Bubka/2FAuth *//**
 * @license lucide-vue-next v0.503.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=de("send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]),$=X("web"),S={getSystemInfos(c={}){return $.get("system/infos",{...c})},getLastRelease(c={}){return $.get("system/latestRelease",{...c})},sendTestEmail(c={}){return $.post("system/test-email",{},{...c})},clearCache(c={}){return $.get("system/clear-cache",{...c})},optimize(c={}){return $.get("system/optimize",{...c})}},pe={class:"columns is-mobile is-vcentered"},me={class:"column is-narrow"},he={class:"column has-text-grey"},_e={class:"is-size-7",href:"https://github.com/Bubka/2FAuth/releases"},fe={key:1},be={key:2},ge={__name:"VersionChecker",setup(c){const b=B(),m=h(!1),d=h();async function w(){m.value=!0,d.value=void 0,await S.getLastRelease({returnError:!0}).then(o=>{b.latestRelease=o.data.newRelease,d.value=o.data.newRelease===null?null:o.data.newRelease===!1}).catch(()=>{d.value=null}),m.value=!1}return(o,u)=>(r(),p("div",pe,[e("div",me,[e("button",{type:"button",class:F([s(m)?"is-loading":"","button is-link is-rounded is-small"]),onClick:w},a(o.$t("label.check_now")),3)]),e("div",he,[i(s(le),null,{default:E(({mode:V})=>[s(b).latestRelease?(r(),p("span",{key:0,class:F(["mt-2",V=="dark"?"has-text-warning":"has-text-warning-dark"])},[u[0]||(u[0]=e("span",{class:"release-flag"},null,-1)),C(a(o.$t("message.x_is_available",{version:s(b).latestRelease}))+"Â ",1),e("a",_e,a(o.$t("link.view_on_github")),1)],2)):f("",!0),s(d)?(r(),p("span",fe,[s(d)?(r(),D(s(ie),{key:0,class:"mr-1 has-text-success inline"})):f("",!0),C(a(o.$t("message.you_are_up_to_date")),1)])):s(d)===null?(r(),p("span",be,[i(s(re),{class:"mr-1 has-text-danger inline"}),C(a(o.$t("error.check_failed_try_later")),1)])):f("",!0)]),_:1})])]))}},ye={class:"options-tabs"},ve={class:"title is-4 pt-4 has-text-grey-light"},ke={class:"field"},$e={class:"label",for:"btnTestEmail"},Ce={class:"help"},Ee={class:"help"},Se={class:"is-family-code has-text-info"},Fe={class:"columns is-mobile is-vcentered"},we={class:"column is-narrow"},Ve={class:"icon is-small"},Ie={key:0,class:"about-debug box is-family-monospace is-size-7"},Te={class:"field"},Ue={class:"label",for:"lnkHealthCheck"},Re={class:"help"},Ne={class:"title is-4 pt-5 has-text-grey-light"},ze={class:"help"},Be={class:"title is-4 pt-5 has-text-grey-light"},De={class:"title is-4 pt-5 has-text-grey-light"},xe={class:"field"},Le={for:"btnClearCache",class:"label"},Ae={class:"help"},je={class:"field mb-5 is-grouped"},He={class:"control"},Me={class:"field"},Pe={for:"btnCopyEnvVars",class:"label"},We={key:0,class:"about-debug box is-family-monospace is-size-7"},Ge=["value"],Xe={class:"has-text-grey"},qe={key:1,class:"about-debug box is-family-monospace is-size-7 has-text-warning-dark"},st={__name:"AppSetup",setup(c){const b=q(),{t:m}=J(),d=Q("2fauth"),w=K(),o=ae(),u=B(),V=O(d.prefix+"returnTo","accounts"),g=h(),R=h(null),I=h(!1),y=h(null),T=h(!1),x=d.config.subdirectory+"/up",L=location.hostname+d.config.subdirectory+"/up";function A(){I.value=!0,y.value=null,S.sendTestEmail({returnError:!0}).then(t=>{o.success({text:m("notification.test_email_sent")})}).catch(t=>{t.response.status===424?y.value=t.response.data.details:b.show(t)}).finally(()=>{I.value=!1})}function j(){T.value=!0,S.clearCache().then(t=>{o.success({text:m("notification.cache_cleared")})}).finally(()=>{T.value=!1})}async function U(t,n){const{error:v}=await oe(t,n);v==null&&o.success({text:m("notification.setting_saved")})}return Y(t=>{t.name.startsWith("admin.")||o.clear()}),Z(async()=>{await u.fetch(),S.getSystemInfos({returnError:!0}).then(t=>{g.value=t.data.common}).catch(()=>{g.value=null})}),(t,n)=>{const v=_("FormCheckbox"),H=_("i18n-t"),M=_("FormFieldError"),P=_("FormWrapper"),W=_("NavigationButton"),G=_("VueFooter");return r(),p("div",null,[i(s(ee),{tabs:s(ne),"active-tab":"admin.appSetup",onTabSelected:n[0]||(n[0]=k=>("router"in t?t.router:s(z)).push({name:k}))},null,8,["tabs"]),e("div",ye,[i(P,null,{default:E(()=>{var k;return[e("form",null,[e("h4",ve,a(t.$t("heading.general")),1),i(v,{modelValue:s(u).checkForUpdate,"onUpdate:modelValue":[n[1]||(n[1]=l=>s(u).checkForUpdate=l),n[2]||(n[2]=l=>U("checkForUpdate",l))],fieldName:"checkForUpdate",label:"field.check_for_update",help:"field.check_for_update.help"},null,8,["modelValue"]),i(ge),e("div",ke,[e("label",$e,a(t.$t("field.test_email")),1),e("p",Ce,a(t.$t("field.test_email.help")),1),e("p",Ee,[i(H,{keypath:"message.email_will_be_send_to_x",tag:"span"},{email:E(()=>[e("span",Se,a(s(w).email),1)]),_:1})])]),e("div",Fe,[e("div",we,[e("button",{id:"btnTestEmail",type:"button",class:F([s(I)?"is-loading":"","button is-link is-rounded is-small"]),onClick:A},[e("span",Ve,[i(s(ue),{class:"icon-size-1"})]),e("span",null,a(t.$t("label.send")),1)],2)])]),s(y)?(r(),p("div",Ie,[s(y)?(r(),D(M,{key:0,error:t.$t("error.email_sending_failed"),field:"testEmail"},null,8,["error"])):f("",!0),C(" "+a(s(y)),1)])):f("",!0),e("div",Te,[e("label",Ue,a(t.$t("field.health_endpoint")),1),e("p",Re,a(t.$t("field.health_endpoint.help")),1)]),e("div",{class:"field mb-5"},[e("a",{id:"lnkHealthCheck",target:"_blank",href:x},a(L))]),e("h4",Ne,a(t.$t("heading.storage")),1),i(v,{modelValue:s(u).storeIconsInDatabase,"onUpdate:modelValue":[n[3]||(n[3]=l=>s(u).storeIconsInDatabase=l),n[4]||(n[4]=l=>U("storeIconsInDatabase",l))],fieldName:"storeIconsInDatabase",label:"field.store_icon_to_database",help:"field.store_icon_to_database.help"},null,8,["modelValue"]),e("p",ze,a(t.$t("field.store_icon_to_database.help_bis")),1),e("h4",Be,a(t.$t("heading.security")),1),i(v,{modelValue:s(u).useEncryption,"onUpdate:modelValue":[n[5]||(n[5]=l=>s(u).useEncryption=l),n[6]||(n[6]=l=>U("useEncryption",l))],fieldName:"useEncryption",label:"field.use_encryption",help:"field.use_encryption.help"},null,8,["modelValue"])]),e("h4",De,a(t.$t("heading.environment")),1),e("div",xe,[e("label",Le,a(t.$t("field.cache_management")),1),e("p",Ae,a(t.$t("field.cache_management.help")),1)]),e("div",je,[e("p",He,[e("button",{id:"btnClearCache",type:"button",class:F([s(T)?"is-loading":"","button is-link is-rounded is-small"]),onClick:j},a(t.$t("label.clear")),3)])]),e("div",Me,[e("label",Pe,a(t.$t("label.variables")),1)]),s(g)?(r(),p("div",We,[i(ce,{id:"btnCopyEnvVars",token:(k=s(R))==null?void 0:k.innerText},null,8,["token"]),e("ul",{ref_key:"listInfos",ref:R,id:"listInfos"},[(r(!0),p(te,null,se(s(g),(l,N)=>(r(),p("li",{value:l,key:N},[e("b",null,a(N),1),n[8]||(n[8]=C(": ",-1)),e("span",Xe,a(l),1)],8,Ge))),128))],512)])):s(g)===null?(r(),p("div",qe,a(t.$t("error.error_during_data_fetching")),1)):f("",!0)]}),_:1})]),i(G,null,{default:E(()=>[i(W,{action:"close",onClosed:n[7]||(n[7]=k=>("router"in t?t.router:s(z)).push({name:s(V)})),"current-page-title":t.$t("title.admin.appSetup")},null,8,["current-page-title"])]),_:1})])}}};export{st as default};
