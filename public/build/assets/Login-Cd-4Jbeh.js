import{c as l,m as a,t as i,C as E,D as P,u as q,a8 as z,b as G,r as H,a9 as J,N as Q,o as X,h as $,i as m,e as _,f as t,j as d,k as y,F as v,l as Y,d as n,I as W,g as u,w as C,G as R,n as D,x as Z}from"./app-CLj7mONa.js";import{F as x}from"./Form-CUtLPPZs.js";import{w as ee}from"./webauthnService-CgWrf4CN.js";/*! 2FAuth version 6.0.0 - Copyright (c) 2025 Bubka - https://github.com/Bubka/2FAuth */const se=["id","href"],K={__name:"SsoConnectLink",props:{provider:{type:String,default:"unknown"}},setup(M){const k=M;return(w,p)=>(a(),l("a",{id:"lnkSignWith"+k.provider,class:"button is-link",href:"socialite/redirect/"+k.provider},i(w.$t("label."+k.provider)),9,se))}},te={key:0,class:"notification is-warning has-text-centered"},ne={class:"block"},ie={class:"nav-links"},ae={key:0,class:"mt-4"},oe={key:1,class:"columns mt-4 is-variable is-1"},le={class:"column is-narrow py-1"},re={class:"column py-1"},ue={class:"buttons"},de={key:0,class:"notification is-info has-text-centered is-radiusless"},me={key:1,class:"notification is-warning has-text-centered is-radiusless"},_e={class:"nav-links"},pe={class:""},ge={class:""},ce={key:2,class:"buttons mt-4"},fe={key:3,class:"is-italic"},ye={class:"nav-links"},ve=["href"],ke={key:0,class:"notification is-info has-text-centered is-radiusless"},we={key:1,class:"notification is-warning has-text-centered is-radiusless"},be={key:2,class:"notification is-warning has-text-centered"},he={class:"nav-links"},$e=["aria-label"],Se={key:0,class:"mt-4"},Fe={key:1,class:"columns mt-4 is-variable is-1"},Le={class:"column is-narrow py-1"},Ve={class:"column py-1"},Be={class:"buttons"},Ke={__name:"Login",setup(M){const k=E(),{t:w}=P(),p=Q("2fauth"),N=Y(),O=q(),b=Z(),g=z(),r=G(new x({email:"",password:""})),B=H(!1),c=J(p.prefix+"activeLoginForm",null);X(()=>{g.enableSso==!0&&g.useSsoOnly==!0?c.value="sso":(c.value==null||c.value=="sso")&&(c.value="legacy")});function h(s){r.clear(),c.value=s}function I(s){b.clear(),r.post("/user/login",{returnError:!0}).then(async e=>{await O.loginAs({id:e.data.id,name:e.data.name,email:e.data.email,oauth_provider:e.data.oauth_provider,authenticated_by_proxy:!1,preferences:e.data.preferences,isAdmin:e.data.is_admin}),N.push({name:"accounts"})}).catch(e=>{var S,F;((S=e.response)==null?void 0:S.status)===401?b.alert({text:w("notification.authentication_failed"),duration:1e4}):((F=e.response)==null?void 0:F.status)!==422&&k.show(e)})}function T(){b.clear(),r.clear(),B.value=!0,ee.authenticate(r.email).then(async s=>{await O.loginAs({id:s.data.id,name:s.data.name,email:s.data.email,oauth_provider:s.data.oauth_provider,authenticated_by_proxy:!1,preferences:s.data.preferences,isAdmin:s.data.is_admin}),N.push({name:"accounts"})}).catch(s=>{"webauthn"in s?s.name=="is-warning"?b.warn({text:w(s.message)}):b.alert({text:w(s.message)}):s.response.status===401?b.alert({text:w("notification.authentication_failed"),duration:1e4}):s.response.status==422?r.errors.set(r.extractErrors(s.response)):k.show(s)}).finally(()=>{B.value=!1})}return(s,e)=>{const S=y("FormField"),F=y("FormButtons"),L=y("RouterLink"),A=y("FormWrapper"),V=y("i18n-t"),j=y("FormPasswordField"),U=y("VueFooter");return a(),l(v,null,[t(c)=="webauthn"?(a(),$(A,{key:0,title:"heading.webauthn_login",punchline:"message.welcome_to_2fauth"},{default:d(()=>[t(g).enableSso==!0&&t(g).useSsoOnly==!0?(a(),l("div",te,i(s.$t("message.sso_only_form_restricted_to_admin")),1)):m("",!0),n("div",ne,i(s.$t("message.use_security_device_to_sign_in")),1),n("form",{id:"frmWebauthnLogin",onSubmit:W(T,["prevent"]),onKeydown:e[1]||(e[1]=o=>t(r).onKeydown(o))},[_(S,{modelValue:t(r).email,"onUpdate:modelValue":e[0]||(e[0]=o=>t(r).email=o),fieldName:"email",errorMessage:t(r).errors.get("email"),inputType:"email",label:"field.email",autofocus:""},null,8,["modelValue","errorMessage"]),_(F,{isBusy:t(B),submitLabel:"label.continue",submitId:"btnContinue"},null,8,["isBusy"])],32),n("div",ie,[n("p",null,[u(i(s.$t("message.lost_your_device"))+"  ",1),_(L,{id:"lnkRecoverAccount",to:{name:"webauthn.lost"},class:"is-link"},{default:d(()=>[u(i(s.$t("link.recover_your_account")),1)]),_:1})]),n("p",null,[u(i(s.$t("message.sign_in_using"))+"  ",1),n("a",{id:"lnkSignWithLegacy",role:"button",class:"is-link",onKeyup:e[2]||(e[2]=C(o=>h("legacy"),["enter"])),onClick:e[3]||(e[3]=o=>h("legacy")),tabindex:"0"},i(s.$t("link.login_and_password")),33)]),t(g).disableRegistration==!1&&t(g).useSsoOnly==!1?(a(),l("p",ae,[u(i(s.$t("message.dont_have_account_yet"))+"  ",1),_(L,{id:"lnkRegister",to:{name:"register"},class:"is-link"},{default:d(()=>[u(i(s.$t("link.register")),1)]),_:1})])):m("",!0),t(g).enableSso==!0&&Object.values(t(p).config.sso).includes(!0)?(a(),l("div",oe,[n("div",le,i(s.$t("message.or_continue_with")),1),n("div",re,[n("div",ue,[(a(!0),l(v,null,R(t(p).config.sso,(o,f)=>(a(),l(v,{key:f},[o?(a(),$(K,{key:0,class:D("is-outlined is-small"),provider:f},null,8,["provider"])):m("",!0)],64))),128))])])])):m("",!0)])]),_:1})):t(c)=="sso"?(a(),$(A,{key:1,title:"heading.sso_login",punchline:"message.welcome_to_2fauth"},{default:d(()=>[t(p).isDemoApp?(a(),l("div",de,[u(i(s.$t("message.welcome_to_demo_app")),1),e[13]||(e[13]=n("br",null,null,-1)),_(V,{keypath:"message.sign_in_using_email_password",tag:"span"},{email:d(()=>[...e[11]||(e[11]=[n("strong",null,"demo@2fauth.app",-1)])]),password:d(()=>[...e[12]||(e[12]=[n("strong",null,"demo",-1)])]),_:1})])):m("",!0),t(p).isTestingApp?(a(),l("div",me,[u(i(s.$t("message.welcome_to_testing_app"))+" ",1),_(V,{keypath:"message.use_those_credentials",tag:"span"},{email:d(()=>[...e[14]||(e[14]=[n("strong",null,"testing@2fauth.app",-1)])]),password:d(()=>[...e[15]||(e[15]=[n("strong",null,"password",-1)])]),_:1})])):m("",!0),n("div",_e,[n("p",pe,i(s.$t("message.password_login_and_webauthn_are_disabled")),1),n("p",ge,i(s.$t("message.sign_in_using_sso")),1)]),Object.values(t(p).config.sso).includes(!0)?(a(),l("div",ce,[(a(!0),l(v,null,R(t(p).config.sso,(o,f)=>(a(),l(v,{key:f},[o?(a(),$(K,{key:0,provider:f},null,8,["provider"])):m("",!0)],64))),128))])):(a(),l("p",fe,"- "+i(s.$t("message.no_provider"))+" -",1)),n("div",ye,[n("p",null,[u(i(s.$t("message.no_sso_provider_or_provider_is_missing"))+"  ",1),n("a",{id:"lnkSsoDocs",class:"is-link",tabindex:"0",href:t(p).urls.ssoDocUrl,target:"_blank"},i(s.$t("link.see_how_to_enable_sso")),9,ve)]),n("p",null,[u(i(s.$t("message.if_administrator"))+"  ",1),n("a",{id:"lnkSignWithLegacy",role:"button",class:"is-link",onKeyup:e[4]||(e[4]=C(o=>h("legacy"),["enter"])),onClick:e[5]||(e[5]=o=>h("legacy")),tabindex:"0"},i(s.$t("link.sign_in_here")),33)])])]),_:1})):t(c)=="legacy"?(a(),$(A,{key:2,title:"heading.login",punchline:"message.welcome_to_2fauth"},{default:d(()=>[t(p).isDemoApp?(a(),l("div",ke,[u(i(s.$t("message.welcome_to_demo_app")),1),e[18]||(e[18]=n("br",null,null,-1)),_(V,{keypath:"message.sign_in_using_email_password",tag:"span"},{email:d(()=>[...e[16]||(e[16]=[n("strong",null,"demo@2fauth.app",-1)])]),password:d(()=>[...e[17]||(e[17]=[n("strong",null,"demo",-1)])]),_:1})])):m("",!0),t(p).isTestingApp?(a(),l("div",we,[u(i(s.$t("message.welcome_to_testing_app"))+" ",1),_(V,{keypath:"message.use_those_credentials",tag:"span"},{email:d(()=>[...e[19]||(e[19]=[n("strong",null,"testing@2fauth.app",-1)])]),password:d(()=>[...e[20]||(e[20]=[n("strong",null,"password",-1)])]),_:1})])):m("",!0),t(g).enableSso==!0&&t(g).useSsoOnly==!0?(a(),l("div",be,i(s.$t("message.sso_only_form_restricted_to_admin")),1)):m("",!0),n("form",{id:"frmLegacyLogin",onSubmit:W(I,["prevent"]),onKeydown:e[8]||(e[8]=o=>t(r).onKeydown(o))},[_(S,{modelValue:t(r).email,"onUpdate:modelValue":e[6]||(e[6]=o=>t(r).email=o),fieldName:"email",errorMessage:t(r).errors.get("email"),inputType:"email",label:"field.email",autocomplete:"username",autofocus:""},null,8,["modelValue","errorMessage"]),_(j,{modelValue:t(r).password,"onUpdate:modelValue":e[7]||(e[7]=o=>t(r).password=o),fieldName:"password",errorMessage:t(r).errors.get("password"),label:"field.password",autocomplete:"current-password"},null,8,["modelValue","errorMessage"]),_(F,{isBusy:t(r).isBusy,submitLabel:"label.sign_in",submitId:"btnSignIn"},null,8,["isBusy"])],32),n("div",he,[n("p",null,[u(i(s.$t("message.forgot_your_password"))+"  ",1),_(L,{id:"lnkResetPwd",to:{name:"password.request"},class:"is-link","aria-label":s.$t("label.reset_your_password")},{default:d(()=>[u(i(s.$t("link.request_password_reset")),1)]),_:1},8,["aria-label"])]),n("p",null,[u(i(s.$t("message.sign_in_using"))+"  ",1),n("a",{id:"lnkSignWithWebauthn",role:"button",class:"is-link",onKeyup:e[9]||(e[9]=C(o=>h("webauthn"),["enter"])),onClick:e[10]||(e[10]=o=>h("webauthn")),tabindex:"0","aria-label":s.$t("tooltip.sign_in_using_security_device")},i(s.$t("link.security_device")),41,$e)]),t(g).disableRegistration==!1&&t(g).useSsoOnly==!1?(a(),l("p",Se,[u(i(s.$t("message.dont_have_account_yet"))+"  ",1),_(L,{id:"lnkRegister",to:{name:"register"},class:"is-link"},{default:d(()=>[u(i(s.$t("link.register")),1)]),_:1})])):m("",!0),t(g).enableSso&&Object.values(t(p).config.sso).includes(!0)?(a(),l("div",Fe,[n("div",Le,i(s.$t("message.or_continue_with")),1),n("div",Ve,[n("div",Be,[(a(!0),l(v,null,R(t(p).config.sso,(o,f)=>(a(),l(v,{key:f},[o?(a(),$(K,{key:0,class:D("is-outlined is-small"),provider:f},null,8,["provider"])):m("",!0)],64))),128))])])])):m("",!0)])]),_:1})):m("",!0),_(U)],64)}}};export{Ke as default};
