import{D as ht,u as vt,a as gt,r as _,b as U,v as j,q as _t,o as kt,J as X,x as yt,h as F,j as M,f as l,N as bt,k as y,m as n,d as t,e as a,c as r,t as o,i as p,n as P,F as T,G as I,g as f,w as Z,a0 as wt,E as Y,I as $t,a1 as tt,S as Ct,Q as zt}from"./app-CsCdPRLz.js";import{F as H}from"./Form-BqPELsYX.js";import{u as xt}from"./bus-Basus4b9.js";import{U as At}from"./index-BpXPhS-I.js";import{Q as Ft}from"./qr-code-Bn3dM2q0.js";import{c as B}from"./createLucideIcon-B_q_KK3i.js";import{C as h}from"./check-mSr7a7Jc.js";import{X as et}from"./x-06iSIDoF.js";import{C as Mt}from"./circle-alert-DyGv_UhV.js";/*! 2FAuth version 6.0.0 - Copyright (c) 2025 Bubka - https://github.com/Bubka/2FAuth *//**
 * @license lucide-vue-next v0.503.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const St=B("circle-x",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-vue-next v0.503.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qt=B("file-text",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-vue-next v0.503.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vt=B("text-cursor-input",[["path",{d:"M12 20h-1a2 2 0 0 1-2-2 2 2 0 0 1-2 2H6",key:"1528k5"}],["path",{d:"M13 8h7a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2h-7",key:"13ksps"}],["path",{d:"M5 16H4a2 2 0 0 1-2-2v-4a2 2 0 0 1 2-2h1",key:"1n9rhb"}],["path",{d:"M6 4h1a2 2 0 0 1 2 2 2 2 0 0 1 2-2h1",key:"1mj8rg"}],["path",{d:"M9 6v12",key:"velyjx"}]]);/**
 * @license lucide-vue-next v0.503.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Et=B("triangle-alert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),Nt={class:"title has-text-grey-dark"},Pt={key:0},Tt={class:"block is-size-7-mobile"},It={class:"mb-2"},Bt={class:"columns"},Ot={class:"column"},Dt={class:"block"},Ut={class:"card"},jt={class:"card-content"},Ht={class:"media"},Rt={class:"media-left"},Jt={class:"image is-32x32"},Qt={class:"media-content"},Lt={class:"title is-5 has-text-grey"},Wt={class:"subtitle is-6 is-size-7-mobile"},Gt={class:"card-footer"},Kt={class:"block"},Xt={class:"card"},Zt={class:"card-content"},Yt={class:"media"},te={class:"media-left"},ee={class:"image is-32x32"},se={class:"media-content"},le={class:"title is-5 has-text-grey"},ie={class:"subtitle is-6 is-size-7-mobile"},oe={class:"card-footer"},ne={class:"block"},ae={class:"card"},re={class:"card-content"},de={class:"media"},ue={class:"media-left"},ce={class:"image is-32x32"},pe={class:"media-content"},me={class:"title is-5 has-text-grey"},fe={class:"subtitle is-6 is-size-7-mobile"},he={class:"content"},ve={class:"card-footer"},ge={class:"title is-5 has-text-grey-dark"},_e={class:"block is-size-7-mobile"},ke={class:"table is-size-7-mobile is-fullwidth"},ye={key:1},be={key:2},we={class:"block is-size-7-mobile"},$e={class:"mb-2"},Ce={class:"is-flex is-justify-content-space-between"},ze=["onClick","title"],xe=["src"],Ae={key:1,class:"is-flex-grow-1 has-ellipsis"},Fe={key:2,class:"tags is-flex-wrap-nowrap"},Me=["onClick","title"],Se=["onClick","title"],qe={key:3,class:"has-nowrap"},Ve={key:0,class:"has-text-success"},Ee={key:1,class:"has-text-danger"},Ne={class:"is-size-6 is-size-7-mobile"},Pe={class:"is-family-primary has-text-grey"},Te={key:0,class:"has-text-danger"},Ie={key:1,class:"has-text-warning"},Be={key:2},Oe={key:0,class:"mt-2 is-size-7 is-pulled-right"},De={key:1,class:"mt-2 is-size-7 is-pulled-right"},Ue={key:0,class:"control"},Ze={__name:"Import",setup(je){const{t:u}=ht(),R=bt("2fauth"),m=yt(),J=vt(),O=xt(),Q=gt(),C=_(null),S=_(null),q=_(null),b=_(null),V=_(null),z=U(new H({service:"",account:"",otp_type:"",icon:"",secret:"",algorithm:"",digits:null,counter:null,period:null})),w=U(new H({file:null,withSecret:!0})),k=U(new H({qrcode:null,withSecret:!0})),$=_(!1);u("label.qr_code"),u("label.plain_text");const d=_([]),v=_(!1),x=j(()=>d.value.filter(s=>s.imported==-1&&s.id>-2).length),L=j(()=>d.value.filter(s=>s.id===-1&&s.imported===-1).length),st=j(()=>d.value.filter(s=>s.imported===1).length);_t($,s=>{var e;s==!1&&((e=C.value)==null||e.clearOTP())}),kt(()=>{O.migrationUri&&(D(O.migrationUri),O.migrationUri=null)});async function D(s,e=null){v.value=!0,await X.migrate(s,{returnError:!0}).then(g=>{g.data.forEach(E=>{E.imported=-1,d.value.push(E)}),G(),b.value=V.value=null}).catch(g=>{m.alert({text:u(g.response.data.message)}),e!=null&&g.response.status===422&&(e.clear(),e.errors.set(e.extractErrors(g.response)))}).finally(()=>{v.value=!1})}function lt(){var s;confirm(u("confirmation.discard_duplicates"))&&(m.clear(),(s=C.value)==null||s.clearOTP(),d.value=d.value.filter(e=>e.id!==-1))}function it(){var s;confirm(u("confirmation.discard_all"))&&(m.clear(),(s=C.value)==null||s.clearOTP(),d.value=[])}function ot(s){confirm(u("confirmation.discard"))&&d.value.splice(s,1)}async function nt(){for(let s=0;s<d.value.length;s++)d.value[s].imported==-1&&await W(s);Q.sortDefault()}async function W(s){z.fill(d.value[s]),await z.post("/api/v1/twofaccounts",{returnError:!0}).then(e=>{d.value[s].imported=1,d.value[s].id=e.data.id,delete e.data.secret,Q.items.push(e.data)}).catch(e=>{d.value[s].imported=0,d.value[s].id=0,d.value[s].errors=z.errors.flatten()})}function at(s){z.fill(d.value[s]),$.value=!0,zt().then(()=>{C.value.show()})}function rt(){w.clear(),v.value=!0,w.file=S.value.files[0],w.upload("/api/v1/twofaccounts/migration",{returnError:!0}).then(s=>{s.data.forEach(e=>{e.imported=-1,d.value.push(e)}),G()}).catch(s=>{var e;s.response.status===422?((e=s.response.data.errors)==null?void 0:e.file)==null&&m.alert({text:u("error.invalid_2fa_data")}):m.alert({text:s.response.data.message})}).finally(()=>{v.value=!1})}function dt(){k.clear(),v.value=!0,k.qrcode=q.value.files[0],k.upload("/api/v1/qrcode/decode",{returnError:!0}).then(s=>{D(s.data.data,k)}).catch(s=>{var e;s.response.status===422?((e=s.response.data.errors)==null?void 0:e.qrcode)==null&&m.alert({text:u("error.invalid_2fa_data")}):m.alert({text:s.response.data.message})}).finally(()=>{v.value=!1})}function G(){m.success({text:u("notification.x_valid_accounts_found",{count:x.value})})}function ut(){V.value=null,b.value?D(b.value):V.value=u("validation.required",{attribute:"Direct input"})}return(s,e)=>{const g=y("FormFieldError"),E=y("RouterLink"),ct=y("Spinner"),K=y("NavigationButton"),pt=y("VueFooter"),mt=y("ResponsiveWidthWrapper"),ft=y("Modal");return n(),F(l(At),null,{default:M(({mode:N})=>[t("div",null,[a(mt,null,{default:M(()=>[t("h1",Nt,o(s.$t("heading.import")),1),!l(v)&&l(d).length===0?(n(),r("div",Pt,[t("div",Tt,[t("p",It,o(s.$t("message.import_legend")),1),t("p",null,o(s.$t("message.import_legend_afterpart")),1)]),t("div",Bt,[t("div",Ot,[t("div",Dt,[t("div",Ut,[t("div",jt,[t("div",Ht,[t("div",Rt,[t("figure",Jt,[a(l(Ft),{class:P(["icon-size-2",N=="dark"?"has-text-grey-darker":"has-text-grey-lighter"])},null,8,["class"])])]),t("div",Qt,[t("p",Lt,o(s.$t("heading.qr_code")),1),t("p",Wt,o(s.$t("message.supported_formats_for_qrcode_upload")),1)])]),l(k).errors.any()?(n(!0),r(T,{key:0},I(l(k).errors.all(),(i,c)=>(n(),F(g,{key:c,error:l(k).errors.get(c),field:c},null,8,["error","field"]))),128)):p("",!0)]),t("footer",Gt,[a(E,{id:"btnCapture",to:{name:"capture"},class:"card-footer-item"},{default:M(()=>[f(o(s.$t("link.scan")),1)]),_:1}),t("a",{role:"button",tabindex:"0",class:"card-footer-item is-relative",onClick:e[0]||(e[0]=i=>l(q).click()),onKeyup:e[1]||(e[1]=Z(i=>l(q).click(),["enter"]))},[t("input",{inert:"",tabindex:"-1",class:"file-input",type:"file",accept:"image/*",onChange:dt,ref_key:"qrcodeInput",ref:q},null,544),f(" "+o(s.$t("label.upload")),1)],32)])])]),t("div",Kt,[t("div",Xt,[t("div",Zt,[t("div",Yt,[t("div",te,[t("figure",ee,[a(l(qt),{class:P(["icon-size-2",N=="dark"?"has-text-grey-darker":"has-text-grey-lighter"])},null,8,["class"])])]),t("div",se,[t("p",le,o(s.$t("label.text_file")),1),t("p",ie,o(s.$t("message.supported_formats_for_file_upload")),1)])]),l(w).errors.any()?(n(!0),r(T,{key:0},I(l(w).errors.all(),(i,c)=>(n(),F(g,{key:c,error:l(w).errors.get(c),field:c},null,8,["error","field"]))),128)):p("",!0)]),t("footer",oe,[t("a",{role:"button",tabindex:"0",class:"card-footer-item is-relative",onClick:e[2]||(e[2]=i=>l(S).click()),onKeyup:e[3]||(e[3]=Z(i=>l(S).click(),["enter"]))},[t("input",{inert:"",tabindex:"-1",class:"file-input",type:"file",accept:"text/plain,application/json,text/csv,.2fas",onChange:rt,ref_key:"fileInput",ref:S},null,544),f(" "+o(s.$t("label.upload")),1)],32)])])]),t("div",ne,[t("div",ae,[t("div",re,[t("div",de,[t("div",ue,[t("figure",ce,[a(l(Vt),{class:P(["icon-size-2",N=="dark"?"has-text-grey-darker":"has-text-grey-lighter"])},null,8,["class"])])]),t("div",pe,[t("p",me,o(s.$t("message.direct_input")),1),t("p",fe,o(s.$t("message.expected_format_for_direct_input")),1)])]),t("div",he,[a(l(wt),{modelValue:l(b),"onUpdate:modelValue":e[4]||(e[4]=i=>Y(b)?b.value=i:null),errorMessage:l(V),fieldName:"payload",rows:"5",size:"is-small"},null,8,["modelValue","errorMessage"])])]),t("footer",ve,[t("a",{role:"button",tabindex:"0",class:"card-footer-item is-relative",onClick:$t(ut,["stop"])},o(s.$t("label.submit")),1)])])])])]),t("h2",ge,o(s.$t("heading.supported_migration_formats")),1),t("div",_e,[a(l(Et),{class:"inline icon-size-1 has-text-warning-dark"}),f(" "+o(s.$t("message.do_not_set_password_or_encryption")),1)]),t("table",ke,[e[34]||(e[34]=t("thead",null,[t("tr",null,[t("th"),t("th",null,"Plain text"),t("th",null,"QR code"),t("th",null,"JSON")])],-1)),t("tbody",null,[t("tr",null,[e[14]||(e[14]=t("th",null,"Google Authenticator",-1)),e[15]||(e[15]=t("td",null,null,-1)),t("td",null,[a(l(h),{"stroke-width":"3",class:"icon-size-1"})]),e[16]||(e[16]=t("td",null,null,-1))]),t("tr",null,[e[17]||(e[17]=t("th",null,"Aegis Auth",-1)),t("td",null,[a(l(h),{"stroke-width":"3",class:"icon-size-1"})]),e[18]||(e[18]=t("td",null,null,-1)),t("td",null,[a(l(h),{"stroke-width":"3",class:"icon-size-1"})])]),t("tr",null,[e[19]||(e[19]=t("th",null,"2FAS auth",-1)),e[20]||(e[20]=t("td",null,null,-1)),e[21]||(e[21]=t("td",null,null,-1)),t("td",null,[a(l(h),{"stroke-width":"3",class:"icon-size-1"})])]),t("tr",null,[e[22]||(e[22]=t("th",null,"FreeOTP+",-1)),t("td",null,[a(l(h),{"stroke-width":"3",class:"icon-size-1"})]),e[23]||(e[23]=t("td",null,null,-1)),e[24]||(e[24]=t("td",null,null,-1))]),t("tr",null,[e[25]||(e[25]=t("th",null,"2FAuth",-1)),e[26]||(e[26]=t("td",null,null,-1)),e[27]||(e[27]=t("td",null,null,-1)),t("td",null,[a(l(h),{"stroke-width":"3",class:"icon-size-1"})])]),t("tr",null,[e[28]||(e[28]=t("th",null,"Bitwarden",-1)),e[29]||(e[29]=t("td",null,null,-1)),e[30]||(e[30]=t("td",null,null,-1)),t("td",null,[a(l(h),{"stroke-width":"3",class:"icon-size-1"})])]),t("tr",null,[e[31]||(e[31]=t("th",null,"Bitwarden Authenticator",-1)),e[32]||(e[32]=t("td",null,null,-1)),e[33]||(e[33]=t("td",null,null,-1)),t("td",null,[a(l(h),{"stroke-width":"3",class:"icon-size-1"})])])])])])):l(v)&&l(d).length===0?(n(),r("div",ye,[a(ct,{type:"fullscreen-overlay",isVisible:!0,message:"message.parsing_data"})])):(n(),r("div",be,[t("div",we,[t("p",$e,o(s.$t("message.submitted_data_parsed_now_accounts_are_awaiting_import")),1),t("p",null,o(s.$t("message.use_buttons_to_save_or_discard")),1)]),(n(!0),r(T,null,I(l(d),(i,c)=>(n(),r("div",{key:i.name,class:"group-item is-size-5 is-size-6-mobile"},[t("div",Ce,[i.id>-2&&i.imported!==0?(n(),r("div",{key:0,class:"is-flex-grow-1 has-ellipsis is-clickable",onClick:A=>at(c),title:s.$t("tooltip.generate_a_test_password")},[i.icon&&l(J).preferences.showAccountsIcons?(n(),r("img",{key:0,role:"presentation",class:"import-icon",src:l(R).config.subdirectory+"/storage/icons/"+i.icon,alt:""},null,8,xe)):p("",!0),f(" "+o(i.account),1)],8,ze)):(n(),r("div",Ae,o(i.account),1)),i.imported===-1?(n(),r("div",Fe,[i.id>-2?(n(),r("button",{key:0,type:"button",class:"button tag is-link",onClick:A=>W(c),title:s.$t("tooltip.import_this_account")},o(s.$t("label.to_import")),9,Me)):p("",!0),t("button",{type:"button",class:P(["button tag",{"is-dark has-text-grey-light":N=="dark"}]),onClick:A=>ot(c),title:s.$t("tooltip.discard_this_account")},[a(l(et),{class:"icon-size-1"})],10,Se)])):(n(),r("div",qe,[i.imported===1?(n(),r("span",Ve,[f(o(s.$t("message.imported"))+" ",1),a(l(h),{class:"inline"})])):(n(),r("span",Ee,[f(o(s.$t("message.failure"))+" ",1),a(l(et),{class:"inline"})]))]))]),t("div",Ne,[t("div",Pe,o(s.$t("label.issuer"))+": "+o(i.service),1),i.id===-2?(n(),r("div",Te,[a(l(St),{class:"mr-1 icon-size-1 inline"}),f(o(i.secret),1)])):p("",!0),i.id===-1&&i.imported!==1&&!i.errors?(n(),r("div",Ie,[a(l(Mt),{class:"mr-1 icon-size-1 inline"}),f(o(s.$t("message.possible_duplicate")),1)])):p("",!0),i.errors?(n(),r("ul",Be,[(n(!0),r(T,null,I(i.errors,A=>(n(),r("li",{key:A,class:"has-text-danger"},o(A),1))),128))])):p("",!0)])]))),128)),l(x)>0?(n(),r("div",Oe,[l(L)?(n(),r("button",{key:0,onClick:e[5]||(e[5]=i=>lt()),type:"button",class:"has-text-grey button is-small is-ghost"},o(s.$t("label.discard_duplicates"))+" ("+o(l(L))+")",1)):p("",!0),t("button",{onClick:e[6]||(e[6]=i=>it()),type:"button",class:"has-text-grey button is-small is-ghost"},o(s.$t("label.discard_all")),1)])):p("",!0),l(st)==l(d).length?(n(),r("div",De,[t("button",{onClick:e[7]||(e[7]=i=>d.value=[]),type:"button",class:"has-text-grey button is-small is-ghost"},o(s.$t("label.clear")),1)])):p("",!0)])),a(pt,null,{default:M(()=>[l(x)>0?(n(),r("p",Ue,[t("button",{type:"button",class:"button is-link is-rounded is-focus",onClick:nt},[t("span",null,o(s.$t("label.import_all"))+" ("+o(l(x))+")",1)])])):p("",!0),l(x)>0?(n(),F(K,{key:1,action:"cancel",onCanceled:e[8]||(e[8]=i=>("router"in s?s.router:l(tt)).push({name:"accounts"}))})):(n(),F(K,{key:2,action:"close",onClosed:e[9]||(e[9]=i=>("router"in s?s.router:l(tt)).push({name:"accounts"})),"current-page-title":s.$t("title.importAccounts")},null,8,["current-page-title"]))]),_:1})]),_:2},1024),a(ft,{modelValue:l($),"onUpdate:modelValue":e[13]||(e[13]=i=>Y($)?$.value=i:null)},{default:M(()=>[a(l(Ct),{ref_key:"otpDisplay",ref:C,accountParams:l(z).data(),preferences:l(J).preferences,twofaccountService:l(X),iconPathPrefix:l(R).config.subdirectory,onPleaseCloseMe:e[10]||(e[10]=i=>$.value=!1),onOtpCopiedToClipboard:e[11]||(e[11]=i=>l(m).success({text:l(u)("notification.copied_to_clipboard")})),onError:e[12]||(e[12]=i=>s.errorHandler.show(i))},null,8,["accountParams","preferences","twofaccountService","iconPathPrefix"])]),_:1},8,["modelValue"])])]),_:1})}}};export{Ze as default};
