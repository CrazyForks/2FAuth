import{C as j,D as E,u as K,a8 as M,a9 as W,N as P,r as x,v as R,o as q,q as G,Y as b,a3 as H,c as d,e as l,d as n,f as t,l as I,aa as J,j as y,k as p,m as h,i as w,t as a,w as Y,g as F,F as Q,G as X,n as Z,x as ee}from"./app-CLj7mONa.js";import{t as te}from"./tabs-DgL9eyj5.js";import{w as se}from"./webauthnService-CgWrf4CN.js";import{U as ne}from"./index-DHvNF7PZ.js";import{C as ae}from"./circle-plus-BHhfDgt8.js";import"./createLucideIcon-DUteC7o6.js";/*! 2FAuth version 6.0.0 - Copyright (c) 2025 Bubka - https://github.com/Bubka/2FAuth */const ie={class:"options-tabs"},oe={key:0,class:"notification is-warning has-text-centered"},le={key:1,class:"notification is-warning has-text-centered"},re={class:"title is-4 has-text-grey-light"},ue={class:"is-size-7-mobile"},ce={class:"mt-3"},de={key:2,class:"field"},he=["onClick","title"],pe={class:"mt-2 is-size-7 is-pulled-right"},_e={class:"title is-4 pt-6 has-text-grey-light"},me={class:"field"},fe={class:"help"},ge={class:"help mt-3"},We={__name:"WebAuthn",setup(ve){const k=j(),{t:r}=E(),C=P("2fauth"),i=K(),$=M(),u=ee(),m=I(),V=W(C.prefix+"returnTo","accounts"),N=W(C.prefix+"activeLoginForm","legacy"),o=x([]),f=x(!1),_=R(()=>$.enableSso&&$.useSsoOnly||i.authenticated_by_proxy);q(()=>{B()}),G(()=>i.preferences.useWebauthnOnly,()=>{b.updatePreference("useWebauthnOnly",i.preferences.useWebauthnOnly).then(e=>{u.success({text:r("notification.setting_saved")})})});function S(){if(_.value==!0)return u.warn({text:r("error.unsupported_with_reverseproxy")}),!1;se.register().then(e=>{m.push({name:"settings.webauthn.editCredential",params:{credentialId:JSON.parse(e.config.data).id}})}).catch(e=>{var s;"webauthn"in e?e.name=="is-warning"?u.warn({text:r(e.message)}):u.alert({text:r(e.message)}):((s=e.response)==null?void 0:s.status)===422?u.alert({text:e.response.data.message}):k.show(e)})}function O(e){confirm(r("confirmation.revoke_device"))&&b.revokeWebauthnDevice(e).then(s=>{o.value=o.value.filter(g=>g.id!==e),o.value.length==0&&(i.preferences.useWebauthnOnly=!1),u.success({text:r("notification.device_revoked")})})}function D(e){return e.alias?e.alias:r("label.my_device")+" (#"+e.id.substring(0,10)+")"}function B(){f.value=!0,b.getWebauthnDevices({returnError:!0}).then(e=>{o.value=e.data}).catch(e=>{e.response.status===403||k.show(e)}).finally(()=>{f.value=!1})}async function z(){N.value="webauthn"}return H(e=>{e.name.startsWith("settings.")||u.clear()}),(e,s)=>{const g=p("Spinner"),L=p("FormCheckbox"),A=p("NavigationButton"),T=p("VueFooter"),U=p("FormWrapper");return h(),d("div",null,[l(t(J),{tabs:t(te),"active-tab":"settings.webauthn.devices",onTabSelected:s[0]||(s[0]=c=>t(m).push({name:c}))},null,8,["tabs"]),n("div",ie,[l(U,null,{default:y(()=>[t(_)&&t(i).oauth_provider?(h(),d("div",oe,a(e.$t("message.sso_only_x_settings_are_disabled",{auth_method:"WebAuthn"})),1)):w("",!0),t(_)&&t(i).authenticated_by_proxy?(h(),d("div",le,a(e.$t("message.auth_handled_by_proxy")+" "+e.$t("message.manage_auth_at_proxy_level")),1)):w("",!0),n("h4",re,a(e.$t("heading.security_devices")),1),n("div",ue,a(e.$t("message.security_devices_legend")),1),n("div",ce,[n("a",{tabindex:"0",onClick:S,onKeyup:Y(S,["enter"])},[l(t(ae)),F("Â "+a(e.$t("link.register_a_new_device")),1)],32)]),t(o).length>0?(h(),d("div",de,[l(t(ne),null,{default:y(({mode:c})=>[(h(!0),d(Q,null,X(t(o),v=>(h(),d("div",{key:v.id,class:"group-item is-size-5 is-size-6-mobile"},[F(a(D(v))+" ",1),n("button",{type:"button",class:Z(["button tag is-pulled-right",c==="dark"?"is-dark":"is-white"]),onClick:be=>O(v.id),title:e.$t("tooltip.revoke")},a(e.$t("label.revoke")),11,he)]))),128))]),_:1}),n("div",pe,a(e.$t("message.revoking_a_device_is_permanent")),1)])):w("",!0),l(g,{isVisible:t(f)&&t(o).length===0,type:"list-loading"},null,8,["isVisible"]),n("h4",_e,a(e.$t("heading.options")),1),n("div",me,a(e.$t("message.need_a_security_device_to_enable_options")),1),n("form",null,[l(L,{modelValue:t(i).preferences.useWebauthnOnly,"onUpdate:modelValue":[s[1]||(s[1]=c=>t(i).preferences.useWebauthnOnly=c),s[2]||(s[2]=c=>z())],fieldName:"useWebauthnOnly",label:"field.use_webauthn_only",help:"field.use_webauthn_only.help",isDisabled:t(_)||t(o).length===0},null,8,["modelValue","isDisabled"]),n("p",fe,a(e.$t("field.use_webauthn_only.help_bis")),1),n("p",ge,a(e.$t("field.use_webauthn_only.help_ter")),1)]),l(T,null,{default:y(()=>[l(A,{action:"close",onClosed:s[3]||(s[3]=c=>t(m).push({name:t(V)})),"current-page-title":e.$t("title.settings.webauthn.devices")},null,8,["current-page-title"])]),_:1})]),_:1})])])}}};export{We as default};
