import{_ as Y}from"./CopyButton-DvYqEWxi.js";import{_ as O}from"./AccessLogViewer-Cszq0Out.js";import{C as Q,D as J,u as K,r as v,o as X,Y as h,h as z,j as y,f as o,l as Z,N as ee,k as f,m as n,e as _,d as s,c as r,t as i,i as d,n as m,g,F as se,G as te,Q as P,x as ie}from"./app-CLj7mONa.js";import{U as oe}from"./index-DHvNF7PZ.js";import{u as ae}from"./bus-Bwv5YVcY.js";import"./createLucideIcon-DUteC7o6.js";import"./x-BF3-YSPD.js";import"./check-BaUiYB3M.js";/*! 2FAuth version 6.0.0 - Copyright (c) 2025 Bubka - https://github.com/Bubka/2FAuth */const ne={class:"title has-text-grey-dark mb-6"},re={key:1},le={class:"has-text-weight-light has-text-grey-dark is-pulled-right"},de={class:"subtitle is-6 block"},ue={key:0,class:"notification is-dark is-size-7-mobile has-text-centered"},ce={class:"block is-size-6 is-size-7-mobile has-text-grey"},_e={class:"block"},he={key:1,class:"title is-4 has-text-grey-light"},fe={key:2,class:"block"},me={class:"list-item is-size-6 is-size-6-mobile has-text-grey"},pe={class:"mb-3 is-flex is-justify-content-space-between"},ge={class:"has-text-weight-bold"},ke={class:"tags ml-3 is-right"},be=["title"],ve=["title"],ye={class:"is-size-7 is-size-7-mobile has-text-grey-dark"},we={key:0,class:"is-block block"},$e={key:1,class:"is-block block"},xe={key:2,class:"is-block block"},ze={class:"is-block block"},Ce={class:"list-item is-size-6 is-size-6-mobile has-text-grey is-flex is-justify-content-space-between"},Ue={class:"has-text-weight-bold"},Ve={class:"is-block is-family-primary has-text-grey-dark"},Fe={key:0},Ee={class:"tags ml-3 is-right"},Ie=["title"],Ne={class:"list-item is-size-6 is-size-6-mobile has-text-grey is-flex is-justify-content-space-between"},Pe={class:"has-text-weight-bold"},Be={class:"is-block has-text-grey-dark"},Se={key:0},je={class:"tags ml-3 is-right"},Te=["title"],qe={class:"block"},Le={class:"title is-5 has-text-grey-light mb-2"},Me={key:3,class:"block is-size-6 is-size-7-mobile has-text-grey"},Re={class:"title is-4 has-text-grey-light"},We={class:"about-debug box is-family-monospace is-size-7"},Ae=["value"],De={class:"has-text-grey"},Ge={class:"title is-4 has-text-danger"},He={class:"is-left-bordered-danger"},Ye={class:"block is-size-6 is-size-7-mobile"},Oe={class:"is-block has-text-grey has-text-weight-bold"},is={__name:"Manage",props:{userId:[Number,String]},setup(B){const k=Q(),{t:l}=J(),c=ie(),w=Z(),C=K(),S=ae(),U=ee("2fauth"),$=v(!1),t=v(null),V=v(null),F=v(!1),x=B;X(async()=>{await j()});async function j(){$.value=!0,h.getById(x.userId,{returnError:!0}).then(e=>{t.value=e.data,S.username=t.value.info.name}).catch(e=>{k.show(e)}).finally(()=>{$.value=!1})}async function T(){if(!b())return!1;confirm(l("confirmation.purge_password_reset_request"))===!0&&(await h.resendPasswordEmail(t.value.info.id),t.value.password_reset=null)}async function q(){if(!b())return!1;confirm(l("confirmation.request_password_reset"))===!0&&h.resetPassword(t.value.info.id,{returnError:!0}).then(e=>{t.value=e.data,c.success({text:l("notification.password_successfully_reset")})}).catch(e=>{e.response.status===400?c.alert({text:e.response.data.reason}):k.show(e)})}function L(e){if(!confirm(l("confirmation.change_admin_role"))){P().then(()=>{t.value.info.is_admin=!e});return}if(e===!1&&t.value.info.id===C.id&&!confirm(l("confirmation.demote_own_account"))){P().then(()=>{t.value.info.is_admin=!0});return}h.promote(t.value.info.id,{is_admin:e},{returnError:!0}).then(a=>{t.value.info.is_admin=a.data.info.is_admin,c.success({text:l("notification.user_role_updated")})}).catch(a=>{a.response.status===403?(c.alert({text:a.response.data.message}),t.value.info.is_admin=!0):k.show(a)})}function M(){if(!b())return!1;confirm(l("confirmation.delete_user"))&&h.delete(t.value.info.id,{returnError:!0}).then(e=>{c.success({text:l("notification.user_account_successfully_deleted")}),w.push({name:"admin.users"})}).catch(e=>{e.response.status===403?c.alert({text:e.response.data.message}):k.show(e)})}function R(){if(!b())return!1;h.revokePATs(t.value.info.id).then(e=>{t.value.valid_personal_access_tokens=0,c.success({text:l("notification.pats_succesfully_revoked")})})}function b(){return!(t.value.info.id===C.id&&!confirm(l("confirmation.edit_own_account")))}return(e,a)=>{const W=f("Spinner"),A=f("FormCheckbox"),D=f("router-link"),E=f("NavigationButton"),G=f("VueFooter"),H=f("ResponsiveWidthWrapper");return n(),z(o(oe),null,{default:y(({mode:p})=>[_(H,null,{default:y(()=>{var I;return[s("h1",ne,i(e.$t("heading.user_management")),1),o($)||!o(t)?(n(),z(W,{key:0,isVisible:!0,type:"fullscreen-overlay",message:"message.fetching_data"})):(n(),r("div",re,[s("div",{class:m(["mb-6",o(t).info.is_admin?"is-left-bordered-warning":"is-left-bordered-link"])},[s("p",{class:m(["title is-4",{"has-text-grey-lighter":p=="dark"}])},[s("span",le,"#"+i(o(t).info.id),1),g(i(o(t).info.name),1)],2),s("p",de,i(o(t).info.email),1)],2),o(t).info.oauth_provider?(n(),r("div",ue,i(e.$t("message.account_bound_to_x_via_oauth",{provider:o(t).info.oauth_provider})),1)):d("",!0),s("div",ce,i(e.$t("message.registered_on_date",{date:o(t).info.created_at}))+" - "+i(e.$t("message.last_seen_on_date",{date:o(t).info.last_seen_at})),1),s("div",_e,[_(A,{modelValue:o(t).info.is_admin,"onUpdate:modelValue":[a[0]||(a[0]=u=>o(t).info.is_admin=u),a[1]||(a[1]=u=>L(u===!0))],fieldName:"is_admin",label:"field.is_admin",help:"field.is_admin.help"},null,8,["modelValue"])]),o(U).config.proxyAuth?d("",!0):(n(),r("h2",he,i(e.$t("heading.access")),1)),o(U).config.proxyAuth?d("",!0):(n(),r("div",fe,[s("div",me,[s("div",pe,[s("div",null,[s("span",ge,i(e.$t("heading.password")),1)]),s("div",null,[s("div",ke,[o(t).password_reset?(n(),r("button",{key:0,type:"button",class:m(["button tag is-pulled-right",p=="dark"?"is-dark has-background-link":"is-white"]),onClick:T,title:e.$t("tooltip.resend_email_title")},i(e.$t("label.resend_email")),11,be)):d("",!0),s("button",{type:"button",class:m(["button tag is-pulled-right",p=="dark"?"is-dark has-background-link":"is-white"]),onClick:q,title:e.$t("tooltip.reset_password_title")},i(e.$t("label.reset_password")),11,ve)])])]),s("div",ye,[o(t).password_reset===0?(n(),r("span",we,i(e.$t("message.password_request_expired")),1)):o(t).password_reset?(n(),r("span",$e,i(e.$t("message.password_requested_on_t",{datetime:o(t).password_reset})),1)):d("",!0),o(t).password_reset?(n(),r("span",xe,i(e.$t("message.resend_email_help")),1)):d("",!0),s("span",ze,i(e.$t("message.reset_password_help")),1)])]),s("div",Ce,[s("div",null,[s("span",Ue,i(e.$t("heading.personal_access_tokens")),1),s("span",Ve,i(e.$t("message.user_has_x_active_pat",{count:o(t).valid_personal_access_tokens})),1)]),o(t).valid_personal_access_tokens>0?(n(),r("div",Fe,[s("div",Ee,[s("button",{type:"button",class:m(["button tag is-pulled-right",p=="dark"?"is-dark has-background-link":"is-white"]),onClick:R,title:e.$t("tooltip.revoke_all_pat_for_user")},i(e.$t("label.revoke")),11,Ie)])])):d("",!0)]),s("div",Ne,[s("div",null,[s("span",Pe,i(e.$t("heading.security_devices")),1),s("span",Be,i(e.$t("message.user_has_x_security_devices",{count:o(t).webauthn_credentials})),1)]),o(t).webauthn_credentials>0?(n(),r("div",Se,[s("div",je,[s("button",{type:"button",class:m(["button tag is-pulled-right",p=="dark"?"is-dark has-background-link":"is-white"]),title:e.$t("tooltip.revoke_all_devices_for_user")},i(e.$t("label.revoke")),11,Te)])])):d("",!0)])])),s("div",qe,[s("h3",Le,i(e.$t("heading.last_accesses")),1),o(t)?(n(),z(O,{key:0,userId:x.userId,lastOnly:!0,onHasMoreEntries:a[2]||(a[2]=u=>F.value=!0)},null,8,["userId"])):d("",!0)]),o(F)?(n(),r("div",Me,[g(i(e.$t("message.access_log_has_more_entries"))+" ",1),_(D,{id:"lnkFullLogs",to:{name:"admin.logs.access",params:{userId:x.userId}}},{default:y(()=>[g(i(e.$t("link.see_full_log"))+". ",1)]),_:1},8,["to"])])):d("",!0),s("h2",Re,i(e.$t("heading.preferences")),1),s("div",We,[_(Y,{id:"btnCopyEnvVars",token:(I=o(V))==null?void 0:I.innerText},null,8,["token"]),s("ul",{ref_key:"listUserPreferences",ref:V,id:"listUserPreferences"},[(n(!0),r(se,null,te(o(t).info.preferences,(u,N)=>(n(),r("li",{value:u,key:N},[s("b",null,i(N),1),a[5]||(a[5]=g(": ",-1)),s("span",De,i(u),1)],8,Ae))),128))],512)]),s("h2",Ge,i(e.$t("heading.danger_zone")),1),s("div",He,[s("div",Ye,[g(i(e.$t("message.delete_this_user_legend"))+" ",1),s("span",Oe,i(e.$t("message.this_is_not_soft_delete")),1)]),s("button",{type:"button",class:"button is-danger",onClick:M,title:"delete"},i(e.$t("label.delete_this_user")),1)])])),_(G,null,{default:y(()=>[_(E,{action:"back",onGoback:a[3]||(a[3]=u=>o(w).push({name:"admin.users"})),"previous-page-title":e.$t("title.admin.users")},null,8,["previous-page-title"]),_(E,{action:"close",onClosed:a[4]||(a[4]=u=>o(w).push({name:"accounts"})),"current-page-title":e.$t("title.admin.manageUser")},null,8,["current-page-title"])]),_:1})]}),_:2},1024)]),_:1})}}};export{is as default};
