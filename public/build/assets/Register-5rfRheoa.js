import{C as I,D as T,u as K,r as k,b as F,a3 as U,c as g,h as V,e as n,f as s,j as m,k as d,l as W,m as u,d as i,t as r,g as c,I as D,x as P}from"./app-CsCdPRLz.js";import{F as B}from"./Form-BqPELsYX.js";import{w as j}from"./webauthnService-D9LDN7tv.js";import{C as A}from"./check-mSr7a7Jc.js";import"./createLucideIcon-B_q_KK3i.js";/*! 2FAuth version 6.0.0 - Copyright (c) 2025 Bubka - https://github.com/Bubka/2FAuth */const E={class:"block"},H={key:0,class:"field"},J={id:"lblDeviceRegistrationSuccess",class:"label mb-5"},O={key:1,class:"field is-grouped"},Y={class:"control"},q={class:"control"},z={class:"block"},G={class:"nav-links"},ae={__name:"Register",setup(Q){const R=I(),{t:M}=T(),b=K(),p=P(),N=W(),w=k(!1),f=k(null),t=F(new B({name:"",email:"",password:"",password_confirmation:""})),l=F(new B({name:""}));async function $(a){t.password_confirmation=t.password,t.post("/user").then(e=>{b.$patch({name:e.data.name,email:e.data.email,preferences:e.data.preferences,isAdmin:e.data.is_admin??!1}),b.applyTheme(),w.value=!0})}function C(){j.register().then(a=>{const e=JSON.parse(a.config.data);f.value=e.id}).catch(a=>{a.response.status===422?p.alert({text:a.response.data.message}):R.show(a)})}function L(a){l.patch("/webauthn/credentials/"+f.value+"/name").then(()=>{p.success({text:M("notification.device_successfully_registered")}),N.push({name:"accounts"})})}return U(()=>{p.clear()}),(a,e)=>{const _=d("FormField"),y=d("FormButtons"),h=d("RouterLink"),v=d("FormWrapper"),S=d("FormPasswordField"),x=d("VueFooter");return u(),g("div",null,[s(w)?(u(),V(v,{key:0,title:"heading.authentication",punchline:"message.enhance_security_using_webauthn"},{default:m(()=>[i("div",E,r(a.$t("message.webauthn_uses_trusted_devices")),1),s(f)?(u(),g("div",H,[i("label",J,[c(r(a.$t("notification.device_successfully_registered")),1),n(s(A),{class:"ml-1 inline"})]),i("form",{onSubmit:D(L,["prevent"]),onKeydown:e[1]||(e[1]=o=>s(l).onKeydown(o))},[n(_,{modelValue:s(l).name,"onUpdate:modelValue":e[0]||(e[0]=o=>s(l).name=o),fieldName:"name",errorMessage:s(l).errors.get("name"),inputType:"text",placeholder:"iPhone 12, TouchID, Yubikey 5C",label:"field.name_this_device"},null,8,["modelValue","errorMessage"]),n(y,{isBusy:s(l).isBusy,isDisabled:s(l).isDisabled,submitLabel:"label.continue"},null,8,["isBusy","isDisabled"])],32)])):(u(),g("div",O,[i("div",Y,[i("button",{type:"button",id:"btnRegisterNewDevice",onClick:e[2]||(e[2]=o=>C()),class:"button is-link"},r(a.$t("label.register_a_device")),1)]),i("div",q,[n(h,{id:"btnMaybeLater",to:{name:"accounts"},class:"button is-text"},{default:m(()=>[c(r(a.$t("link.maybe_later")),1)]),_:1})])]))]),_:1})):(u(),V(v,{key:1,title:"heading.register",punchline:"message.welcome_to_2fauth"},{default:m(()=>[i("div",z,r(a.$t("message.you_need_an_account_to_go_further")),1),i("form",{onSubmit:D($,["prevent"]),onKeydown:e[6]||(e[6]=o=>s(t).onKeydown(o))},[n(_,{modelValue:s(t).name,"onUpdate:modelValue":e[3]||(e[3]=o=>s(t).name=o),fieldName:"name",errorMessage:s(t).errors.get("name"),inputType:"text",label:"field.name",autocomplete:"username",maxLength:255,autofocus:""},null,8,["modelValue","errorMessage"]),n(_,{modelValue:s(t).email,"onUpdate:modelValue":e[4]||(e[4]=o=>s(t).email=o),fieldName:"email",errorMessage:s(t).errors.get("email"),inputType:"email",label:"field.email",autocomplete:"email",maxLength:255},null,8,["modelValue","errorMessage"]),n(S,{modelValue:s(t).password,"onUpdate:modelValue":e[5]||(e[5]=o=>s(t).password=o),fieldName:"password",errorMessage:s(t).errors.get("password"),showRules:!0,autocomplete:"new-password",label:"field.password"},null,8,["modelValue","errorMessage"]),n(y,{isBusy:s(t).isBusy,isDisabled:s(t).isDisabled,submitLabel:"label.register",submitId:"btnRegister"},null,8,["isBusy","isDisabled"])],32),i("div",G,[i("p",null,[c(r(a.$t("message.already_register"))+"Â ",1),n(h,{id:"lnkSignIn",to:{name:"login"},class:"is-link"},{default:m(()=>[c(r(a.$t("link.sign_in")),1)]),_:1})])])]),_:1})),n(x)])}}};export{ae as default};
